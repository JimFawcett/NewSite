<!DOCTYPE html>
<html id="top">
<!--
  CppBites_STR.html
-->
<head>
  <title>CppBites STR</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/x-icon" href="./images/favicon.ico" />
  <link rel="stylesheet" href="../css/reset.css" />
  <link rel="stylesheet" href="../css/ContentMenus.css" />
  <link rel="stylesheet" href="../css/Content.css" />
  <link rel="stylesheet" href="../css/help.css" />
  <link rel="stylesheet" href="../css/ThemeCpp.css" />
  <link rel="stylesheet" href="../css/StylesPhoto.css" />
  <link rel="stylesheet" href="../css/StylesSizerComp.css" />
  <link rel="stylesheet" href="../css/StylesWebComponents.css" />
  <script src="../js/ScriptsWebComponents.js"></script>
  <script src="../js/Content.js"></script>
  <script src="../js/ContentMenus.js"></script>
  <link rel="stylesheet" href="../css/FigureSizer.css" />
  <script src="../js/FigureSizer.js"></script>
  <link rel="stylesheet" href="../css/link-nav.css" />
  <link rel="stylesheet" href="../css/content-links.css" />
  <script src="../js/cookies.js"></script>
  <script src="../js/contentElements.js"></script>
  <script src="../js/contentMessages.js"></script>
  <link rel="stylesheet" href="../css/prism.css" />
  <script src="../js/prism.js"></script>
  <link rel="stylesheet" href="../css/StylesSplitterBar.css" />
  <script src="../js/ScriptsSplitterBar.js"></script>
  <script>
    function loadInExplorer() {
      const loc = window.location;
      if(loc === window.top.location) {
        window.location = "ExploreCpp.html?src=" + loc;
      }
    }
    function load() {
      loadInExplorer();
      buildBottomMenu();
      postFileName();
      setPersistantElements();
    }
  </script>
  <style>
    /* details {
      width:calc(100vw - 6rem);
    } */
    details summary {
      margin-top: 1rem;
      font-weight: bold;
    }
  </style>
  <style>
    .menuHeader {
      padding:0.0rem 0.5rem 0.25rem 0.5rem;
    }
  </style>
</head>
<body id="github" onload="load()">

  <!-- <a id="next" class="hidden" href="CppBites_STR.html"></a>
  <a id="prev" class="hidden" href="CppBites_Data.html"></a> -->

  <!-- show-hide with 'about' message -->
  <div id="about" class="hidden" onclick="this.classList.toggle('hidden')">
    CppBites_STR.html<br />
    copyright &copy; James Fawcett<br />
    Revised: 01/07/2025
  </div>

  <content-block>
    <header>
      <!--<a class="repoLink" href="https://github.com/JimFawcett">JimFawcett Repositories</a>-->
      <div id="pagetitle" class="header">
        <h2 id="title">C++ Bites: Special class methods and operations</h2>
        <h4 id="subtitle" class="indent">
          demonstrated with STR class
        </h4>
      </div>
      <div class="header" style="position:relative; padding:0.0em 0em 0.25em 0em; margin-top:0.125em; border:2px solid var(--dark);">
        <a class="repoLinks" target="_blank" href="https://github.com/JimFawcett" style="color:var(--atten); margin-top:0.25em; margin-left:1.5em;">About</a>
        <a class="repoLinks" target="_self" href="CppHome.html" style="color:var(--atten); margin-left:1rem;">C++ Track</a>
      </div>

      <!--<div style="padding-right:25px; position:absolute; top:1.1em; right:13em; z-index:5;">-->
    </header>
    <div style="height:2em;"></div>
    <div>
      <div style="width:calc(100vw - 5rem);">
        <div style="padding:1rem; float:right;">
          <photosizer-block src="pictures/STRClassDeclar.JPG" width="350" class="photoSizerBlock right">
            <span style="
      display: inline-block;
      font-weight: bold;
      font-family: 'Comic Sans MS', Tahoma;
      background-color: var(--light);
      width: 100%;
      padding: 5px 0px;
    ">
              Fig 1. STR Class
            </span>
          </photosizer-block>
        </div>
      </div>
      <h3 id="class">1.0 Str - String Class</h3>
      <t-b>
        The Str class represents null terminated strings.  I wrote the code for this class before there was a
        std::string class.  You should, of course, use the std::string class.  However, Str is a really nice
        tool to illustrate how value types are created.
      </t-b>
      <t-b>
        Value types are instances of classes that can be copied and assigned.  When a copy or assignment operation
        completes, there are two unique instances of STR, each with the same state values.  But these states are
        independent.  Should the destination of a copy or assignment change its state, that does not affect, in any
        way the state of the source Str instance.
      </t-b>
      <t-b>
        This is achieved by careful implementation of copy, move, and assignment operations. Each of the items,
        below, shows how to implement every one of the Str class methods and a couple of global functions associated
        with the class, e.g., Str insertion and extraction operators.
      </t-b>
      <t-b>
        For each method in the Str class, declared in the figure at the right, we show, in the following items,
        how to declare, implement, and invoke the method.
      </t-b>
      <t-b>
        <div class="indent" style="color:maroon;">Click on body of image to expand. Click on top bar to contract.</div>
      </t-b>
      <div class="clear"></div>
      <h3 id="methods">2.0 Str Methods</h3>
      <t-b>
        <details>
          <summary><span>Str Default Constructor</span></summary>
          <div style="width:calc(100vw - 5rem);">
            <div style="padding:1rem; float:right; position:relative; top:-3rem;">
              <photosizer-block src="pictures/STRDefaultCtor.JPG" width="300" class="photoSizerBlock right">
                <span style="
        display: inline-block;
        font-weight: bold;
        font-family: 'Comic Sans MS', Tahoma;
        background-color: var(--light);
        width: 100%;
        padding: 5px 0px;
      ">
                  Fig 2. Void Ctor
                </span>
              </photosizer-block>
            </div>
          </div>
        </details>
        <indent-block class="t-b" style="margin-left:20px;">
          Str default constructor initializes an instance of Str with no arguments.  This might be used, for example,
          to construct an array of Str instances.
        </indent-block>
        <spacer-15></spacer-15>
        <details>
          <summary>Str Copy Constructor</summary>
          <div style="width:calc(100vw - 5rem);">
          <div style="padding:1rem; float:right; position:relative; top:-3rem;">
            <photosizer-block src="pictures/STRCopyCtor.JPG" width="300" class="photoSizerBlock right">
              <span style="
      display: inline-block;
      font-weight: bold;
      font-family: 'Comic Sans MS', Tahoma;
      background-color: var(--light);
      width: 100%;
      padding: 5px 0px;
    ">
                Fig 3. Copy Ctor
              </span>
            </photosizer-block>
          </div>
          </div>
        </details>
        <indent-block class="t-b" style="margin-left:20px;">
          Copy constructors play an important role in developing value types, since copying is an essential feature
          for them. Every time we pass a method or function argument by value, we make a copy of the instance on the
          functions stack frame.  The same is true for return by value, and any code that explicitly invokes a copy.
        </indent-block>
        <spacer-15></spacer-15>
        <details>
          <summary>Str Move Constructor</summary>
          <div style="width: calc(100vw - 5rem);">
            <div style="padding:1rem; float:right; position:relative; top:-3rem;">
              <photosizer-block src="pictures/STRMoveCtor.JPG" width="300" class="photoSizerBlock right">
                <span style="
          display: inline-block;
          font-weight: bold;
          font-family: 'Comic Sans MS', Tahoma;
          background-color: var(--light);
          width: 100%;
          padding: 5px 0px;
        ">
                  Fig 4. Move Ctor
                </span>
              </photosizer-block>
            </div>
            </div>
        </details>
        <indent-block class="t-b" style="margin-left:20px;">
          Move constructors allow the compiler to avoid making copies when the source of the copy is a temporary
          instance. A properly designed move constructor will take ownership of the temporary&apos;s state, possibly
          invalidating the temporary object.  That is not a problem as long as a move is the last thing that happens
          before the temporary goes out of scope.
        </indent-block>
        <spacer-15></spacer-15>
        <details>
          <summary>Str Promotion Constructor</summary>
          <div style="width:calc(100vw - 5rem);">
            <div style="padding:1rem; float:right; position:relative; top:-3rem;">
              <photosizer-block src="pictures/STRDefaultCtor.JPG" width="300" class="photoSizerBlock right">
              <span style="
        display: inline-block;
        font-weight: bold;
        font-family: 'Comic Sans MS', Tahoma;
        background-color: var(--light);
        width: 100%;
        padding: 5px 0px;
      ">
                <!--Fig 1. STR Class-->
              </span>
            </photosizer-block>
          </div>
          </div>
        </details>
        <indent-block class="t-b" style="margin-left:20px;">
          Promotion constructors take a single argument of some other type, causing a conversion of the source type
          to the destination type. Essentially the promotion constructor is just using information contained in the
          source to build a new Str instance. For STR, we define a promotion from literal strings to Str instances.
        </indent-block>
        <spacer-15></spacer-15>
        <details>
          <summary>Str Destructor</summary>
          <div style="width:calc(100vw - 5rem);">
            <div style="padding:1rem; float:right; position:relative; top:-3rem;">
              <photosizer-block src="pictures/STRDtor.JPG" width="300" class="photoSizerBlock right">
              <span style="
        display: inline-block;
        font-weight: bold;
        font-family: 'Comic Sans MS', Tahoma;
        background-color: var(--light);
        width: 100%;
        padding: 5px 0px;
      ">
                <!--Fig 1. STR Class-->
              </span>
            </photosizer-block>
          </div>
          </div>
        </details>
        <indent-block class="t-b" style="margin-left:20px;">
          Every class must have a destructor, either defined by the class, or implemented by the compiler.  For STR
          instances, that just deallocates their character storage from the native heap.
        </indent-block>
        <spacer-15></spacer-15>
        <details>
          <summary>Str Copy Assignment Operator</summary>
          <div style="width:calc(100vw - 5rem);">
            <div style="padding:1rem; float:right; position:relative; top:-3rem;">
              <photosizer-block src="pictures/STRCopyAssign.JPG" width="300" class="photoSizerBlock right">
              <span style="
        display: inline-block;
        font-weight: bold;
        font-family: 'Comic Sans MS', Tahoma;
        background-color: var(--light);
        width: 100%;
        padding: 5px 0px;
      ">
                <!--Fig 1. STR Class-->
              </span>
            </photosizer-block>
          </div>
          </div>
        </details>
        <indent-block class="t-b" style="margin-left:20px;">
          Copy assignment changes the state of an existing instance to match the state of a source instance.
          After copy assignment no changes have been made to the source.  The states of the two instances,
          source and destination, have the same values but are stored independently.
        </indent-block>
        <spacer-15></spacer-15>
        <details>
          <summary>Str Move Assignment Operator</summary>
          <div style="width:calc(100vw - 5rem);">
            <div style="padding:1rem; float:right; position:relative; top:-3rem;">
              <photosizer-block src="pictures/STRMoveAssign.JPG" width="300" class="photoSizerBlock right">
              <span style="
        display: inline-block;
        font-weight: bold;
        font-family: 'Comic Sans MS', Tahoma;
        background-color: var(--light);
        width: 100%;
        padding: 5px 0px;
      ">
                <!--Fig 1. STR Class-->
              </span>
            </photosizer-block>
          </div>
          </div>
        </details>
        <indent-block class="t-b" style="margin-left:20px;">
          The idea of move assignment is very like move construction.  The only significant difference is that
          with move construction we are building a new instance, while with move assignment we transfer ownership
          of the source&apos;s state to the destination.  When compiling an assignment expression, the compiler
          will use copy assignment if the source is a named object that will remain in scope.  If the source is
          a temporary object, the compiler will use move assignment.
        </indent-block>
        <spacer-15></spacer-15>
        <details>
          <summary>Str Index Operator</summary>
          <div style="width:calc(100vw - 5rem);">
            <div style="padding:1rem; float:right; position:relative; top:-3rem;">
            <photosizer-block src="pictures/STRIndexOper.JPG" width="300" class="photoSizerBlock" style="margin-top:0;">
              <span style="
        display: inline-block;
        font-weight: bold;
        font-family: 'Comic Sans MS', Tahoma;
        background-color: var(--light);
        width: 100%;
        padding: 5px 0px;
      ">
                <!--Fig 1. STR Class-->
              </span>
            </photosizer-block>
          </div>
          </div>
        </details>
        <indent-block class="t-b" style="margin-left:20px;">
          An index operator is used to access one item of a collection, usually stored as a private member
          of the class.  For non-const indexers, the index operator can be used to both read and write the item.
        </indent-block>
        <spacer-15></spacer-15>
        <details>
          <summary>Str Const Index Operator</summary>
          <div style="width:calc(100vw - 5rem);">
            <div style="padding:1rem; float:right; position:relative; top:-3rem;">
              <photosizer-block src="pictures/STRIndexOperConst.JPG" width="300" class="photoSizerBlock right">
                <span style="
        display: inline-block;
        font-weight: bold;
        font-family: 'Comic Sans MS', Tahoma;
        background-color: var(--light);
        width: 100%;
        padding: 5px 0px;
      ">
                <!--Fig 1. STR Class-->
              </span>
            </photosizer-block>
          </div>
          </div>
        </details>
        <indent-block class="t-b" style="margin-left:20px;">
          A const index operator is used to access one item of a collection for reading, usually stored as a private member
          of the class. This allows indexing a const instance of a class that provides this operator.
        </indent-block>
        <spacer-15></spacer-15>
        <details>
          <summary>Str Append a Character</summary>
          <div style="width:calc(100vw - 5rem);">
            <div style="padding:1rem; float:right; position:relative; top:-3rem;">
            <photosizer-block src="pictures/STRAppendChar.JPG" width="300" class="photoSizerBlock" style="margin-top:0;">
              <span style="
        display: inline-block;
        font-weight: bold;
        font-family: 'Comic Sans MS', Tahoma;
        background-color: var(--light);
        width: 100%;
        padding: 5px 0px;
      ">
                <!--Fig 1. STR Class-->
              </span>
            </photosizer-block>
          </div>
          </div>
        </details>
        <indent-block class="t-b" style="margin-left:20px;">
          The character append operation is a bit complicated, because the Str instance may, or may not, have unallocated
          memory to store the character in its char array.  We have to check the space available and based on the result
          either store in the original array, or create a larger temporary array, copy the original characters, append the
          new one, deallocate the original array, and attach the new one to the instance.
        </indent-block>
        <spacer-15></spacer-15>
        <details>
          <summary>Str Append a String</summary>
          <div style="width:calc(100vw - 5rem);">
            <div style="padding:1rem; float:right; position:relative; top:-3rem;">
            <photosizer-block src="pictures/STRAppendStr.JPG" width="300" class="photoSizerBlock" style="margin-top:0;">
              <span style="
        display: inline-block;
        font-weight: bold;
        font-family: 'Comic Sans MS', Tahoma;
        background-color: var(--light);
        width: 100%;
        padding: 5px 0px;
      ">
                <!--Fig 1. STR Class-->
              </span>
            </photosizer-block>
          </div>
          </div>
        </details>
        <indent-block class="t-b" style="margin-left:20px;">
          This operation is very similar to the preceeding one, but now we check for space for the string.
        </indent-block>
        <spacer-15></spacer-15>
        <details>
          <summary>Str Addition Operator</summary>
          <div style="width:calc(100vw - 5rem);">
            <div style="padding:1rem; float:right; position:relative; top:-3rem;">
            <photosizer-block src="pictures/STRAdd.JPG" width="300" class="photoSizerBlock" style="margin-top:0;">
              <span style="
        display: inline-block;
        font-weight: bold;
        font-family: 'Comic Sans MS', Tahoma;
        background-color: var(--light);
        width: 100%;
        padding: 5px 0px;
      ">
                <!--Fig 1. STR Class-->
              </span>
            </photosizer-block>
          </div>
          </div>
        </details>
        <indent-block class="t-b" style="margin-left:20px;">
          Having implemented the Append operations, implementation of the Addion operator is almost trivial.
        </indent-block>
        <spacer-15></spacer-15>
        <details>
          <summary>Str Cast Operator</summary>
          <div style="width:calc(100vw - 5rem);">
            <div style="padding:1rem; float:right; position:relative; top:-3rem;">
            <photosizer-block src="pictures/STRCast.JPG" width="300" class="photoSizerBlock" style="margin-top:0;">
              <span style="
        display: inline-block;
        font-weight: bold;
        font-family: 'Comic Sans MS', Tahoma;
        background-color: var(--light);
        width: 100%;
        padding: 5px 0px;
      ">
                <!--Fig 1. STR Class-->
              </span>
            </photosizer-block>
          </div>
          </div>
        </details>
        <indent-block class="t-b" style="margin-left:20px;">
          Casts create an instance of a new type based on information stored in the source type.
          For Str instances that simply returns a const pointer to its internal character storage,
          e.g., it returns a const literal string.
        </indent-block>
        <spacer-15></spacer-15>
        <details>
          <summary>Str Insertion Operator</summary>
          <div style="width:calc(100vw - 5rem);">
            <div style="padding:1rem; float:right; position:relative; top:-3rem;">
            <photosizer-block src="pictures/STRInsertionOper.JPG" width="300" class="photoSizerBlock" style="margin-top:0;">
              <span style="
        display: inline-block;
        font-weight: bold;
        font-family: 'Comic Sans MS', Tahoma;
        background-color: var(--light);
        width: 100%;
        padding: 5px 0px;
      ">
                <!--Fig 1. STR Class-->
              </span>
            </photosizer-block>
          </div>
          </div>
        </details>
        <indent-block class="t-b" style="margin-left:20px;">
          Insertion operators have to be implemented as global functions.  For STR, the insertion simply
          streams its characters to the output stream, specified in its calling parameters.
        </indent-block>
        <spacer-15></spacer-15>
        <details>
          <summary>Str Extraction Operator</summary>
          <div style="width:calc(100vw - 5rem);">
            <div style="padding:1rem; float:right; position:relative; top:-3rem;">
            <photosizer-block src="pictures/STRExtractOper.JPG" width="300" class="photoSizerBlock" style="margin-top:0;">
              <span style="
        display: inline-block;
        font-weight: bold;
        font-family: 'Comic Sans MS', Tahoma;
        background-color: var(--light);
        width: 100%;
        padding: 5px 0px;
      ">
                <!--Fig 1. STR Class-->
              </span>
            </photosizer-block>
          </div>
          </div>
        </details>
        <indent-block class="t-b" style="margin-left:20px;">
          Extraction could be complicated because we are streaming in from a source for which we have no
          size information.  However, because we already implemented the character append operation, which
          takes care of ensuring adequate storage, we simply append characters from the source stream.
        </indent-block>
        <spacer-15></spacer-15>
        <details>
          <summary>Coersions</summary>
          <div style="width:calc(100vw - 5rem);">
            <div style="padding:1rem; float:right; position:relative; top:-3rem;">
            <photosizer-block src="pictures/STRCoercions.JPG" width="300" class="photoSizerBlock" style="margin-top:0;">
              <span style="
        display: inline-block;
        font-weight: bold;
        font-family: 'Comic Sans MS', Tahoma;
        background-color: var(--light);
        width: 100%;
        padding: 5px 0px;
      ">
                <!--Fig 1. STR Class-->
              </span>
            </photosizer-block>
          </div>
          </div>
        </details>
        <indent-block class="t-b" style="margin-left:20px;">
          Coercions happen when a compiler applies a promotion constructor or cast operator to
          create an instance of a different type than the source of the coercion.
        </indent-block>
        <spacer-15></spacer-15>
        <details>
          <summary>Binary Operator Model</summary>
          <div style="width:calc(100vw - 5rem);">
            <div style="padding:1rem; float:right; position:relative; top:-3rem;">
            <photosizer-block src="pictures/STRBinaryOper.JPG" width="300" class="photoSizerBlock" style="margin-top:0;">
              <span style="
        display: inline-block;
        font-weight: bold;
        font-family: 'Comic Sans MS', Tahoma;
        background-color: var(--light);
        width: 100%;
        padding: 5px 0px;
      ">
                <!--Fig 1. STR Class-->
              </span>
            </photosizer-block>
          </div>
          </div>
        </details>
        <indent-block class="t-b" style="margin-left:20px;">
          Binary operators can be defined either as class members or global functions.  This item
          discusses the syntax for doing that.
        </indent-block>
        <spacer-15></spacer-15>
        <details>
          <summary>Expression Model</summary>
          <div style="width:calc(100vw - 5rem);">
            <div style="padding:1rem; float:right; position:relative; top:-3rem;">
            <photosizer-block src="pictures/STRExpressions.JPG" width="300" class="photoSizerBlock" style="margin-top:0;">
              <span style="
        display: inline-block;
        font-weight: bold;
        font-family: 'Comic Sans MS', Tahoma;
        background-color: var(--light);
        width: 100%;
        padding: 5px 0px;
      ">
                <!--Fig 1. STR Class-->
              </span>
            </photosizer-block>
          </div>
          </div>
        </details>
        <indent-block class="t-b" style="margin-left:20px;">
          When the compiler scans a C++ expression it looks for type mismatches.  If it finds any, it
          will try to find a cast or promotion operation to resolve the mismatch.  If it finds one
          non-ambiguous way to resolve the types, it applies that way, otherwise compilation fails.
        </indent-block>
        </t-b>
      <t-b>
        This design is fairly large and, in a few places, a bit complicated. However, the result is that
        we can use instances of Str to represent strings, just as if they were of a type defined
        by the C++ language.  We can copy them, assign them, index them, ..., without participating in
        the instance&apos;s resource management.
      </t-b>
      <t-b>
        The result is that the designer had to spend a lot of time getting all the details defined
        correctly, but users simply using the class without having any knowledge about its design
        other than its class interface.
      </t-b>
      <spacer-15></spacer-15>

    </div>
    <div style="height:20em;"></div>
</content-block>
  <div id="bottomMenu">
    <div id="keys" class="hidden"></div>
    <div id="sections" class="hidden">
      <div class="darkItem listheader" onclick="toggleSections()">Sections</div>
      <div class="menuBody">
        <a href="#top">top</a>
        <a href="#class">Str class</a>
        <a href="#methods">methods</a>
        <a href="#bottom">bottom</a>
      </div>
    </div>
    <div id="pages" class="hidden"></div>
    <div id="url" class="hidden">url</div>
    <div id="goto" class="hidden">url</div>
  </div>
  <a id="bottom"></a>
  <script src="js/CppBitesPages.js"></script>
  <script>buildPages()</script>
  <script>createSiteNavMenu('goto')</script>
  <script src="../js/link-nav.js" defer></script>
  <script>
    setCookie('#pages', 4, 10);
  </script>
</body>
</html>
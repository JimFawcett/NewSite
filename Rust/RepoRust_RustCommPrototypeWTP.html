<!DOCTYPE html>
<html id="top">
<!--
  RepoRust_RustCommPrototypeWTP.html
-->
<head>
  <title>Rust Comm PrototypeWTP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/x-icon" href="./images/favicon.ico" />
  <link rel="stylesheet" href="../css/reset.css" />
  <link rel="stylesheet" href="../css/ContentMenus.css" />
  <link rel="stylesheet" href="../css/StylesPhoto.css" />
  <link rel="stylesheet" href="../css/StylesSizerComp.css" />
  <link rel="stylesheet" href="../css/StylesWebComponents.css" />
  <!-- <link rel="stylesheet" href="../css/help.css" /> -->
  <link rel="stylesheet" href="../css/Content.css" />
  <link rel="stylesheet" href="../css/ThemeRust.css" />
  <script src="../js/ScriptsWebComponents.js"></script>
  <script src="../js/Content.js"></script>
  <script src="../js/ContentMenus.js"></script>
  <script src="../js/SitePagesForTools.js"></script>
  <link rel="stylesheet" href="../css/FigureSizer.css" />
  <script src="../js/FigureSizer.js"></script>
  <link rel="stylesheet" href="../css/link-nav.css" />
  <link rel="stylesheet" href="../css/content-links.css" />
  <script src="../js/cookies.js"></script>
  <script src="../js/contentElements.js"></script>
  <script src="../js/contentMessages.js"></script>
  <script>
    function loadInExplorer() {
      const loc = window.location;
      if(loc === window.top.location) {
        window.location = "ExploreReposRust.html?src=" + loc;
      }
    }
    function load() {
      loadInExplorer();
      buildBottomMenu();
      postFileName();
      setPersistantElements();
    }
  </script>
</head>
<body id="github" onload="load()">

  <!-- <a id="next" class="hidden" href="../Cpp/CppHome.html"></a>
  <a id="prev" class="hidden" href="../Site/SiteHome.html"></a> -->

  <!-- show-hide with 'about' message -->
  <div id="about" class="hidden" onclick="this.classList.toggle('hidden')">
    RepoRust_RustCommPrototypeWTP.html<br />
    copyright &copy; James Fawcett<br />
    Revised: 11/07/2025
  </div>

  <content-block>
    <!-- <a id="top"></a> -->
    <header>
      <!--<a class="repoLink" href="https://github.com/JimFawcett">JimFawcett Repositories</a>-->
      <div id="pagetitle">
        <h2 id="title">Rust Comm Prototype with Thread Pool</h2>
        <h4 id="subtitle" class="indent">
          msg passing communicator prototype
        </h4>
      </div>
      <div class="header" style="position:relative; padding:0.0em 0em 0.25em 0em; margin-top:0.05em; border:2px solid var(--dark);">
        <a class="repoLinks" target="_blank" href="https://github.com/JimFawcett" style="color:var(--light); margin-top:0.25em; margin-left:1.5em;">About</a>
        <a class="repoLinks" target="_blank" href="https://github.com/JimFawcett/NewSite/tree/main/Rust" style="margin-left:1.25em; color:var(--light); ">Rust Repo</a>
      </div>

    </header>
    <!-- <div class="note" style="border:2px dashed red;">
      Default settings are not working correctly.  Will fix as time permits.
    </div> -->
        <div class="bb-55">
          <div style="width:calc(100vw - 6rem);">
            <div style="float:right; padding-left:1rem;">
              <photosizer-block src="Pictures/RustCommConcept.jpg" width="350" class="photoSizerBlock right" style="margin-top:1.5rem; margin-right:-2rem;">
                <span style="
          display: inline-block;
          font-weight: bold;
          font-family: 'Comic Sans MS', Tahoma;
          background-color: #ddd;
          width: 100%;
          padding: 5px 0px;
        ">
                  Fig 1. RustComm Concept
                </span>
              </photosizer-block>
            </div>
          </div>
        </div>
        <div class="bb-55">
          <!--<div style="width:calc(100vw - 6rem);">
        <photosizer-block src="Pictures/RustCommStructure.jpg" width="400" class="photoSizerBlock right clear" style="margin-top:0;">
          <span style="
          display: inline-block;
          font-weight: bold;
          font-family: 'Comic Sans MS, Tahoma';
          background-color: #ddd;
          width: 100%;
          padding: 5px 0px;
        ">
            Fig 2. Current RustComm Structure
          </span>
        </photosizer-block>
      </div>-->
          <div style="width:calc(100vw - 6rem);">
            <div style="clear:both; float:right; padding-left:1rem;">
              <photosizer-block src="Pictures/RustCommTest3.jpg" width="350" class="photoSizerBlock right clear" style="margin-top:0.5rem; margin-right:-2rem">
                <span style="
            display: inline-block;
            font-weight: bold;
            font-family: 'Comic Sans MS', Tahoma;
            background-color: #ddd;
            width: 100%;
            padding: 5px 0px;
          ">
                  Fig 2. RustComm Output Test3
                </span>
              </photosizer-block>
            </div>
          </div>
          <div style="width:calc(100vw - 6rem);">
            <div style="clear:both; float:right; padding-left:1rem;">
              <photosizer-block src="Pictures/RustCommOutput_test4.jpg" width="350" class="photoSizerBlock right clear" style="margin-top:0.5rem; margin-right:-2rem;">
                <span style="
            display: inline-block;
            font-weight: bold;
            font-family: 'Comic Sans MS', Tahoma;
            background-color: #ddd;
            width: 100%;
            padding: 5px 0px;
          ">
                  Fig 3. RustComm Output Test4
                </span>
              </photosizer-block>
            </div>
          </div>
          <h3 id="concept">Concept:</h3>
          <t-b>
            RustComm is a facility for sending messages between a Sender and Receiver.  It uses the std::net::TcpStream and
            std::net::TcpListener types.
            <div style="height:0.75em;"></div>
            This is a prototype for message-passing communication system. It provides three user defined types: <c-s>Connector</c-s>,
            <c-s>Listener</c-s>, and <c-s>Message</c-s>, with generic parameters <c-s>M</c-s>, <c-s>P</c-s>, and <c-s>L</c-s>, as shown in Fig. 1.
            <div style="height:0.75em;"></div>
            In this implementation, Listener uses a thread pool to dispatch connections to clients. The thread pool 
            has a fixed number of threads that wait on the server's input queue, so requests are served efficiently.
            <div style="height:0.75em;"></div>
            <c-s>M</c-s> implements the <c-s>Msg</c-s> trait and represents a message to be sent between endpoints.
            <c-s>P</c-s> implements the <c-s>Process&lt;M&gt;</c-s> trait that defines message processing, and
            <c-s>L</c-s> implements the <c-s>Logger</c-s> trait that supports logging events to the console that can be
            turned on or off by the types supplied for <c-s>L</c-s>, e.g., <c-s>VerboseLog</c-s> and <c-s>MuteLog</c-s>.
            <div style="height:0.75em;"></div>
            The RustComm library:
            <t-b class="mtz">
              <ul class="tight mtz">
                <li>
                  Uses queued full-duplex buffered message sending and receiving
                </li>
                <li>
                  Each message has a fixed size header and <c-s>Vec&lt;u8&gt;</c-s> body.
                </li>
                <li>
                  For each <c-s>Connector&lt;P, M, L&gt;</c-s> connection, <c-s>Listener&lt;P, L&gt;</c-s> processes messages
                  until receiving a message with MessageType::END.
                  <c-s>Listener&lt;P, L&gt;</c-s> spawns a thread for each client connection and processes messages in
                  <c-s>P::process_message</c-s>.
                </li>
                <li>
                  In this version, <c-s>P::process_message</c-s> echos back message with &quot;reply&quot; appended as
                  reply to sender.  You observe that behavior by running test1, e.g., <c-s>cargo run --example test1</c-s>.
                </li>
              </ul>
            </t-b>
            <t-b>
              The long-term goal for RustComm is to serve as a prototyping platform for various messaging and processing
              strategies.  This version defines traits: <c-s>Sndr&lt;M&gt;</c-s>, <c-s>Rcvr&lt;M&gt;</c-s>,
              <c-s>Process&lt;M&gt;</c-s>, <c-s>Msg</c-s>, and <c-s>Logger</c-s>.
            </t-b>
            <t-b>
              The user-defined types, <c-s>M</c-s> and <c-s>P</c-s>, are things that change as we change the message structure, defined
              by <c-s>M</c-s> and connector and listener processing defined by <c-s>P</c-s>.
              These types are defined in the rust_comm_processing crate.
              <div style="height:0.75em;"></div>
              The somewhat complex handling of TcpStreams and TcpListener are expected to remain fixed.  They are defined in
              the crate rust_comm.

              Finally, logger <c-s>L</c-s> provides a write method that will,
              using <c-s>VerboseLog</c-s> for <c-s>L</c-s>, write its argument to the console.  <c-s>MuteLog</c-s> simply discards its argument.
            </t-b>
            <t-b>
              The last step in this phase of development was to add a threadpool, as shown in Fig. 1.  The threadpool
              exists and has been integrated into the Listener component. Fig 2. shows the results.
            </t-b>
          </t-b>
          <h3 id="design">Current Design:</h3>
          <t-b>
            <t-b>
              There are three user-defined types: Message, Connector, and Listener.  Connector and Listener each use an
              existing component BlockingQueue&lt;Message&gt;
              <indent-block class="pad5">
                <t-b>
                  <strong>Message:</strong>
                  Methods:
                </t-b>
                <ol class="tight">
                  <li>
                    <strong><c-s>new() -> Message</c-s></strong>
                    <div style="padding:3px 10px 5px 10px;">
                      Create new <c-s>Message</c-s> with empty body and MessageType::TEXT.
                    </div>
                  </li>
                  <li>
                    <strong><c-s>set_type(&mut self, mt: u8)</c-s></strong>
                    <div style="padding:3px 10px 5px 10px;">
                      Set <c-s>MessageType</c-s> member to one of: <c-s>TEXT, BYTES, END</c-s>.
                    </div>
                  </li>
                  <li>
                    <strong><c-s>get_type(&self) -> MessageType</c-s></strong>
                    <div style="padding:3px 10px 5px 10px;">
                      Return <c-s>MessageType</c-s> member value.
                    </div>
                  </li>
                  <li>
                    <strong><c-s>set_body_bytes(&mut self, b: Vec&lt;u8&gt;)</c-s></strong>
                    <div style="padding:3px 10px 5px 10px;">
                      Set <c-s>body_buffer</c-s> member to bytes from<c-s>b: Vec&lt;u8&gt;</c-s>.
                    </div>
                  </li>
                  <li>
                    <strong><c-s>set_body_str(&mut self, s: &str;)</c-s></strong>
                    <div style="padding:3px 10px 5px 10px;">
                      Set <c-s>body_buffer</c-s> member to bytes from<c-s>s: &str</c-s>.
                    </div>
                  </li>
                  <li>
                    <strong><c-s>get_body_size(&self) -> usize</c-s></strong>
                    <div style="padding:3px 10px 5px 10px;">
                      Return size in bytes of body member.
                    </div>
                  </li>
                  <li>
                    <strong><c-s>get_body(&self) -> &Vec&lt;u8&gt;</c-s></strong>
                    <div style="padding:3px 10px 5px 10px;">
                      Return <c-s>body_buffer</c-s> member.
                    </div>
                  </li>
                  <li>
                    <strong><c-s>get_body_str(&self) -> String</c-s></strong>
                    <div style="padding:3px 10px 5px 10px;">
                      Return body contents as lossy <c-s>String</c-s>.
                    </div>
                  </li>
                  <li>
                    <strong><c-s>clear(&self)</c-s></strong>
                    <div style="padding:3px 10px 5px 10px;">
                      clear body contents.
                    </div>
                  </li>
                </ol>
                <t-b>
                  <hr />
                  <div class="pad10">
                    Both <c-s>Connector&lt;P, M, L&gt;</c-s> and <c-s>Listener&lt;P, L&gt;</c-s> are parameterized with <c-s>L</c-s>,
                    a type satisfying a <c-s>Logger</c-s> trait.  The package defines two types that implement the trait,
                    <c-s>VerboseLog</c-s> and <c-s>MuteLog</c-s> that allow users to easily turn on and off event display
                    outputs.  Fig 2. uses <c-s>MuteLog</c-s> in both <c-s>Connector&lt;P, M, L&gt;</c-s> and
                    <c-s>Listener&lt;P, L&gt;</c-s>.
                  </div>
                  <hr />
                </t-b>
                <t-b><strong>Connector&lt;P, M, L&gt;</strong> methods:</t-b>
                <ol class="tight">
                  <li>
                    <strong><c-s>new(addr: &'static str) -> std::io::Result&lt;Connector&lt;P,M,L&gt;&gt;</c-s></strong>
                    <div style="padding:3px 10px 5px 10px;">
                      Create new <c-s>Connector&lt;P,M,L&gt;</c-s> with running send and receive threads.
                    </div>
                  </li>
                  <li>
                    <strong><c-s>is_connected(&self) -> bool</c-s></strong>
                    <div style="padding:3px 10px 5px 10px;">
                      is connected to <c-s>addr</c-s>?.
                    </div>
                  </li>
                  <li>
                    <strong><c-s>post_message(&self, msg: M)</c-s></strong>
                    <div style="padding:3px 10px 5px 10px;">
                      Enqueues msg to send to connected Receiver.
                    </div>
                  </li>
                  <li>
                    <strong><c-s>get_message(&mut self) -> M</c-s></strong>
                    <div style="padding:3px 10px 5px 10px;">
                      Reads reply message if available, else blocks.
                    </div>
                  </li>
                  <li>
                    <strong><c-s>has_message(&self) -> bool</c-s></strong>
                    <div style="padding:3px 10px 5px 10px;">
                      Returns true if reply message is available.
                    </div>
                  </li>
                </ol>
                <t-b><strong>Listener&lt;P, L&gt;</strong> methods:</t-b>
                <ol class="tight">
                  <li>
                    <strong><c-s>new(nt: u8) -> Listener&lt;P, L&gt;</c-s></strong>
                    <div style="padding:3px 10px 5px 10px;">
                      Create new <c-s>Listener&lt;P, L&gt;</c-s> with nt threads running.
                    </div>
                  </li>
                  <li>
                    <strong><c-s>start(&mut self, addr: &'static str) -> std::io::Result&lt;JoinHandle&lt;()&gt;&gt;</c-s></strong>
                    <div style="padding:3px 10px 5px 10px;">
                      Bind <c-s>Listener&lt;P,L&gt;</c-s> to <c-s>addr</c-s> and start listening on dedicated thread.
                    </div>
                  </li>
                </ol>
              </indent-block>
            </t-b>
          </t-b>
          <!--<div class="clear"></div>-->
          <h3 id="oper">Operation:</h3>
          <t-b class="indent">
            This is intended to be a simple test-bed for ideas - easy to use and with very little setup and configuration.
          </t-b>
          <h3>Build:</h3>
          <t-b class="indent">
            Download and, in a command prompt, <c-s>cargo build</c-s> or <c-s>cargo run</c-s>.
          </t-b>
          <h3>Status:</h3>
          <t-b class="indent mtz">
            Expected Changes and Additions:
            <t-b class="mtz">
              <ul class="tight">
                <li>
                  Add file transfer capability
                </li>
                <li>
                  Add user-defined Comm type that composes a <c-s>Connector</c-s> and <c-s>Listener</c-s>.
                </li>
              </ul>
            </t-b>
          </t-b>
        </div>
        <div style="height:15rem;"></div>
  </content-block>
  <div id="bottomMenu">
    <div id="keys" class="hidden"></div>
    <div id="sections" class="hidden">
      <div class="darkItem listheader" onclick="toggleSections()">Sections</div>
      <div class="menuBody">
        <a href="#top">top</a>
        <a href="#find">find</a>
        <a href="#like">what I like</a>
        <a href="#table1">resources</a>
        <a href="#exer">exercises</a>
        <a href="#bottom">bottom</a>
      </div>
    </div>
    <div id="pages" class="hidden"></div>
    <div id="url" class="hidden">url</div>
    <div id="goto" class="hidden">url</div>
  </div>
  <a id="bottom"></a>
  <script src="js/RustRepoPages.js"></script>
  <script>buildPages()</script>
  <script>createSiteNavMenu('goto')</script>
  <script src="../js/link-nav.js" defer></script>
  <script>
    setCookie('#pages', 8, 10);
  </script>
</body>
</html>
<!DOCTYPE html>
<html id="top">
<!--
  RepoRust_RustThreadPool.html
-->
<head>
  <title>Rust ThreadPool</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/x-icon" href="./images/favicon.ico" />
  <link rel="stylesheet" href="../css/reset.css" />
  <link rel="stylesheet" href="../css/ContentMenus.css" />
  <link rel="stylesheet" href="../css/StylesPhoto.css" />
  <link rel="stylesheet" href="../css/StylesSizerComp.css" />
  <link rel="stylesheet" href="../css/StylesWebComponents.css" />
  <!-- <link rel="stylesheet" href="../css/help.css" /> -->
  <link rel="stylesheet" href="../css/Content.css" />
  <link rel="stylesheet" href="../css/ThemeRust.css" />
  <script src="../js/ScriptsWebComponents.js"></script>
  <script src="../js/Content.js"></script>
  <script src="../js/ContentMenus.js"></script>
  <script src="../js/SitePagesForTools.js"></script>
  <link rel="stylesheet" href="../css/FigureSizer.css" />
  <script src="../js/FigureSizer.js"></script>
  <link rel="stylesheet" href="../css/link-nav.css" />
  <link rel="stylesheet" href="../css/content-links.css" />
  <script src="../js/cookies.js"></script>
  <script src="../js/contentElements.js"></script>
  <script src="../js/contentMessages.js"></script>
  <script>
    function loadInExplorer() {
      const loc = window.location;
      if(loc === window.top.location) {
        window.location = "ExploreReposRust.html?src=" + loc;
      }
    }
    function load() {
      loadInExplorer();
      buildBottomMenu();
      postFileName();
      setPersistantElements();
    }
  </script>
</head>
<body id="github" onload="load()">

  <!-- <a id="next" class="hidden" href="../Cpp/CppHome.html"></a>
  <a id="prev" class="hidden" href="../Site/SiteHome.html"></a> -->

  <!-- show-hide with 'about' message -->
  <div id="about" class="hidden" onclick="this.classList.toggle('hidden')">
    RepoRust_RustThreadPool.html<br />
    copyright &copy; James Fawcett<br />
    Revised: 11/06/2025
  </div>

  <content-block>
    <!-- <a id="top"></a> -->
    <header>
      <!--<a class="repoLink" href="https://github.com/JimFawcett">JimFawcett Repositories</a>-->
      <div id="pagetitle">
        <h2 id="title">Rust Thread Pool</h2>
        <h4 id="subtitle" class="indent">
          dipatch threads drawing messages from thread-safe queue<br />
        </h4>
      </div>
      <div class="header" style="position:relative; padding:0.0em 0em 0.25em 0em; margin-top:0.05em; border:2px solid var(--dark);">
        <a class="repoLinks" target="_blank" href="https://github.com/JimFawcett" style="color:var(--light); margin-top:0.25em; margin-left:1.5em;">About</a>
        <a class="repoLinks" target="_blank" href="https://github.com/JimFawcett/NewSite/tree/main/Rust" style="margin-left:1.25em; color:var(--light); ">Rust Repo</a>
      </div>

    </header>
        <div>
          <div style="width:calc(100vw - 6rem);">
            <div style="float:right; padding:0.5rem 0rem 0.25rem 1rem;">
              <photosizer-block src="pictures/ThreadPoolDiagram.jpg" width="400" class="photoSizerBlock right" style="margin-top:1rem; margin-right:-2rem;">
                <span style="
                  display: inline-block;
                  font-weight: bold;
                  font-family: 'Comic Sans MS' Tahoma;
                  background-color: #ddd;
                  width: 100%;
                  padding: 5px 0px;
                ">
                  Fig 1. ThreadPool Structure
                </span>
              </photosizer-block>
            </div>
            <div style="height:0.5rem;"></div>
          </div>
          <div style="width:calc(100vw - 6rem);">
            <div style="clear:both; float:right; padding:0.25rem 0rem 0.25rem 1rem;">
              <photosizer-block src="pictures/RustThreadPoolOutput.JPG" width="400" class="photoSizerBlock right clear" style="margin-top:0.5rem; margin-right:-2rem;">
                <span style="
                  display: inline-block;
                  font-weight: bold;
                  font-family: 'Comic Sans MS', Tahoma;
                  background-color: #ddd;
                  width: 100%;
                  padding: 5px 0px;
                ">
                  Fig 2. ThreadPool Output
                </span>
              </photosizer-block>
            </div>
          </div>
          <h3 id="concept">Concept:</h3>
          <t-b>
            RustThreadPool is a facility for processing a function object concurrently on a specified number of threads,
            using a thread-safe blocking queue.
            <spacer-15></spacer-15>
            This is a nice illustration of how to build a data structure that uses threads for concurrent processing.  I intend to compare
            performance of this facility with message passing some time soon.
            <s-1em></s-1em>
          </t-b>
          <h3 id="design">Design:</h3>
          <t-b>
            <t-b>
              There is one struct, ThreadPool&lt;M&gt;, with an associated function and five methods in this design:
              <indent-block class="pad5">
                <ol class="tight">
                  <li>
                    <strong>
                      <c-s>
                        new&lt;F&gt;(nt:u8, f:F) -> ThreadPool&lt;M&gt;<br />
                        where F: FnOnce(&BlockingQueue&lt;M&gt;) -> () + Send + 'static + Copy
                      </c-s>
                    </strong>
                    <div style="padding:3px 10px 5px 10px;">
                      Create new <c-s>ThreadPool</c-s> which is running nt threads, each processing f().  If f is a closure,
                      then input data can be supplied in its capture.
                      <s-halfEm></s-halfEm>
                      Note that f() needs to be tailored for its message type M.
                      Processing is significantly different for string messages versus work items that contain an execution
                      context.
                      Examples of each are given in the test1.rs in examples folder.
                    </div>
                  </li>
                  <li>
                    <strong><c-s>wait(&mut self)</c-s></strong>
                    <div style="padding:3px 10px 5px 10px;">
                      Waits for all threads to complete.
                    </div>
                  </li>
                  <li>
                    <strong><c-s>post_message(&mut self, msg: M) where M:Debug + Clone</c-s></strong>
                    <div style="padding:3px 10px 5px 10px;">
                      Enqueues Messages for processing.<br />
                      Function object passed to new needs to accept and process posted Messages.
                    </div>
                  </li>
                  <li>
                    <strong><c-s>get_message(&mut self) -> Option&lt;M&gt; where M:Debug + Clone + Default</c-s></strong>
                    <div style="padding:3px 10px 5px 10px;">
                      Dequeues result message. Option is None if there are no messages to dequeue.  Alternate is to simply
                      block on empty, but that may have operational problems.
                    </div>
                  </li>
                  <li class="disable">
                    <strong><c-s>shut_down(&mut self) -> u8</c-s></strong>
                    <div style="padding:3px 10px 5px 10px;">
                      Signals threads to exit when queue is empty.  Returns size of input queue.<br />
                      Sets AtomicBool.
                    </div>
                  </li>
                </ol>
              </indent-block>
            </t-b>
            <t-b>
              Sharing between threads is only possible, due to rules of the Rust language, if the shared items are
              all Mutexes or Condvars, or an aggregate of those, e.g., a tuple, or struct like BlockingQueue.
            </t-b>
            <t-b>
              An instance of BlockingQueue&lt;T&gt; can be shared between threads because it only has two fields
              and those are share-able.  One is a Mutex&lt;VecDeque&lt;T&gt;&gt;, and the other is a Condvar,
              e.g., a condition variable.
            </t-b>
          </t-b>
          <!--<div class="clear"></div>-->
          <h3 id="oper">Operation:</h3>
          <t-b class="indent">
            Operation is illustrated by the test1.rs in /examples.
          </t-b>
          <h3>Build:</h3>
          <t-b class="indent">
            Download and, in a command prompt, <c-s>cargo build</c-s> or <c-s>cargo run</c-s>.
          </t-b>
          <h3>Status:</h3>
          <t-b class="indent">
            There may be some changes after I start building bigger Rust applications.
          </t-b>
        </div>
        <div style="height:15rem;"></div>
  </content-block>
  <div id="bottomMenu">
    <div id="keys" class="hidden"></div>
    <div id="sections" class="hidden">
      <div class="darkItem listheader" onclick="toggleSections()">Sections</div>
      <div class="menuBody">
        <a href="#top">top</a>
        <a href="#find">find</a>
        <a href="#like">what I like</a>
        <a href="#table1">resources</a>
        <a href="#exer">exercises</a>
        <a href="#bottom">bottom</a>
      </div>
    </div>
    <div id="pages" class="hidden"></div>
    <div id="url" class="hidden">url</div>
    <div id="goto" class="hidden">url</div>
  </div>
  <a id="bottom"></a>
  <script src="js/RustRepoPages.js"></script>
  <script>buildPages()</script>
  <script>createSiteNavMenu('goto')</script>
  <script src="../js/link-nav.js" defer></script>
  <script>
    setCookie('#pages', 3, 10);
  </script>
</body>
</html>
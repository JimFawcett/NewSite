<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/x-icon" href="images/favicon.ico" />
  <link rel="stylesheet" href="css/reset.css">
  <script src="js/ContentMenus.js"></script>
  <title>Page Host</title>
  <link rel="stylesheet" href="css/Explorer.css" />
  <script src="js/Explorer.js"></script>
  <style>
    :root {
      --lpanelw: calc(100vw - 15rem);
      --headerht: 2rem;
      --rpanelw: 15rem;
      --dark:#006;
      --light: #cbcdd4;
      --statusred: #FD6A6A;
      --statusgreen: lightgreen;
    }
    body {
      display:flex;
      flex-direction: column;
      position:fixed;
      top:0rem;
      left:0rem;
      height:100dvh;
      width:100dvw;
      margin:0rem;
      padding:0rem;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--light);
    }
    body, #ifrm, header {
      box-sizing: border-box;
    }
    #pgframe {
      width:100%;
      height:calc(100vh - var(--headerht));
      margin:0rem;
      padding: 0rem 0.0rem;
      border:4px solid var(--light);
      border-top:none;
    }
    .showloc {
      border:2px solid red;
      padding:0.25rem 0.75rem;
      margin:0.5rem 0rem;
      height: max-content;
    }
    header {
      display:flex;
      flex-direction: row;
      align-items: center;
      height:var(--headerht);
      margin:0;
      padding-left:1rem;
      font-size:1.0rem;
      vertical-align: middle;
      border:1px solid var(--dark);
    }
    #statusLight {
      background-color: #FD6A6A;
      border:2px solid var(--dark);
      border-radius: 10px;
      height:0.5rem;
      width:1.5rem;
      margin-left:4.5rem;
    }
    .topButton {
      border:2px solid var(--dark);
      border-radius: 10px;
      width:max-content;
      font-size:0.8rem;
      margin-left:1rem;
      text-decoration: none;
    }
    .clickable {
      cursor:pointer;
    }
  </style>
  <script>
    function statusGreen() {
      let status = document.getElementById('statusLight');
      status.style.backgroundColor = 'var(--statusgreen)';
    }
    function statusRed() {
      let status = document.getElementById('statusLight');
      status.style.backgroundColor = 'var(--statusred)';
    }
    window.onmessage = function(e) {
      console.log('PageHost recevied message: ' + e.data);
      switch(e.data.key) {
        case 'loaded':
          statusGreen();
          break;
        case 'loading':
          statusRed();
          console.log('handling loading in PageHost');
          break;
        case 'src':
          let frm = document.getElementById('pgframe');
          frm.src = e.data.value;
          // alert(frm.src);
          break;
        case 'setsections':
          break;
        case 'getsections':
          break;
        case 'setpages':
          break;
        case 'getpages':
          break;
        case 'setblogs':
          break;
        case 'getblogs':
          break;
        case 'sethelp':
          break;
        case 'gethelp':
          break;
        case 'setres':
          break;
        case 'getres':
          break;
        default:
          console.log('default in PageHost message loop');
      }
    }
  </script>
  <script>
    function load() {
      processQueryString();
    }
    function startfs() {
      const element = document.documentElement;
      element.requestFullscreen().catch((err) => {
        console.log(`Error attempting to enable full-screen mode: ${err.message}`);
      });      
    }
    function cancelfs() {
      if(document.fullscreenElement) {
        document.exitFullscreen().catch((err) => { console.log('${err.message}')});
      }
    }
    function togglefs() {
      if(document.fullscreenElement) {
        cancelfs();
      } else {
        startfs();
      }
    }
    function togglerf() {}  // recent files
    function togglebm() {}  // bookmarks
  </script>
</head>
<body onload="load()">
  <header>
    <strong>Page Host</strong>
    <div id="statusLight"></div>
    <button id="fullscreen" class="clickable topButton" onclick="togglefs()">Full Screen</button>
    <button id="recent" class="clickable topButton undef statusLight" onclick="togglerf()">recent files</button>
    <button id="bookmarks" class="clickable topButton undef statusLight" onclick="togglebm()">bookmarks</button>
    <!-- <button id="zoomout" class="clickable topButton " onclick="PageZoom.out()">Zoom -</button>
    <button id="zoomreset" class="clickable topButton " onclick="PageZoom.reset()">Reset</button>
    <button id="zoomin" class="clickable topButton " onclick="PageZoom.in()">Zoom +</button> -->

    <!-- <button id="sections" class="clickable topButton undef statusLight" onclick="togglebm()">sections</button>
    <button id="pages" class="clickable topButton undef" onclick="togglebm()">pages</button> -->
    <!-- <button id="scroll" class="clickable topButton undef" onclick="togglebm()" style="width:10em;">persistent scroll</button> -->
  </header>
  <iframe id="pgframe" src="Site/Explore.html" name = "pgframe"></iframe>
  <!-- <iframe id="pgframe" src="Site/Explore.html" name = "pgframe"></iframe> -->
  <script>
    /* this call has to be here, not in onload processing */
    handleIframeTransition();
  </script>
<!-- Put this at the end of <body> or in a JS file -->
<!-- Drop this anywhere after the <iframe id="pgframe"> exists -->
<!-- <script>
(() => {
  'use strict';

  // -------- Config --------
  const IFRA_ID = 'pgframe';
  const MIN = 0.5, MAX = 2.0, STEP = 0.1;
  const STORE_PREFIX = 'iframeZoom::';

  // -------- State --------
  let scale = 1;

  // Build a per-src storage key so each page can remember its own zoom
  function storeKeyFor(src) {
    return STORE_PREFIX + (src || '');
  }

  // Read saved scale for current iframe src
  function loadSaved(ifr) {
    try {
      const key = storeKeyFor(ifr.src);
      const saved = parseFloat(localStorage.getItem(key));
      return Number.isFinite(saved) ? saved : 1;
    } catch { return 1; }
  }

  function saveScale(ifr, value) {
    try {
      localStorage.setItem(storeKeyFor(ifr.src), String(value));
    } catch {}
  }

  // Attempt to get same-origin iframe document (null if cross-origin)
  function getIframeDoc(ifr) {
    try {
      return ifr.contentDocument || (ifr.contentWindow && ifr.contentWindow.document) || null;
    } catch { return null; } // SecurityError -> cross-origin
  }

  // Core: apply zoom to iframe (prefer inside the iframe; else scale the element)
  function applyIframeZoom(next) {
    const ifr = document.getElementById(IFRA_ID);
    if (!ifr) return;

    scale = Math.min(MAX, Math.max(MIN, parseFloat(Number(next).toFixed(2))));
    saveScale(ifr, scale);

    const idoc = getIframeDoc(ifr);

    if (idoc && idoc.documentElement) {
      // Same-origin: zoom the iframe's page itself
      const html = idoc.documentElement;
      // Prefer CSS zoom when supported (affects layout)
      if (CSS.supports && CSS.supports('zoom', String(scale))) {
        html.style.zoom = scale;
        html.style.transform = '';
        html.style.transformOrigin = '';
        html.style.width = '';
        // Optional: also scale body if needed
        if (idoc.body) idoc.body.style.zoom = '';
      } else {
        // Firefox fallback: transform the <html> node
        html.style.zoom = '';
        html.style.transformOrigin = '0 0';
        html.style.transform = `scale(${scale})`;
        // Ensure the content still fits the iframe viewport
        html.style.width = `calc(100% / ${scale})`;
      }
      // The outer <iframe> element stays 100% size
      ifr.style.transform = '';
      ifr.style.transformOrigin = '';
      ifr.style.width = '';
      ifr.style.height = '';
    } else {
      // Cross-origin: cannot touch inner DOM. Scale the <iframe> element itself.
      ifr.style.transformOrigin = '0 0';
      ifr.style.transform = `scale(${scale})`;
      // Keep the visible area the same size while scaling
      ifr.style.width  = `calc(100% / ${scale})`;
      ifr.style.height = `calc(100% / ${scale})`;
    }
  }

  // Public helpers
  function zoomIn()     { applyIframeZoom(scale + STEP); }
  function zoomOut()    { applyIframeZoom(scale - STEP); }
  function zoomReset()  { applyIframeZoom(1); }
  function zoomApply(x) { applyIframeZoom(x); }

  // Expose simple globals for inline onclick or external code
  window.zoomIn = zoomIn;
  window.zoomOut = zoomOut;
  window.zoomReset = zoomReset;
  window.IframeZoom = { in: zoomIn, out: zoomOut, reset: zoomReset, apply: zoomApply, get: () => scale };

  // Re-apply zoom whenever the iframe loads (e.g., src changes)
  function hookIframe() {
    const ifr = document.getElementById(IFRA_ID);
    if (!ifr) return;
    ifr.addEventListener('load', () => {
      // Load saved value for this src, then apply
      scale = loadSaved(ifr);
      applyIframeZoom(scale);
    });
    // Initialize once for current content
    scale = loadSaved(ifr);
    applyIframeZoom(scale);
  }

  // Optional: wire buttons if present (ids: zoomin / zoomout / zoomreset)
  function wireButtonsIfPresent() {
    document.getElementById('zoomin')?.addEventListener('click', zoomIn);
    document.getElementById('zoomout')?.addEventListener('click', zoomOut);
    document.getElementById('zoomreset')?.addEventListener('click', zoomReset);
  }

  // Start
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => { hookIframe(); wireButtonsIfPresent(); });
  } else {
    hookIframe(); wireButtonsIfPresent();
  }
})();
</script> -->
</body>
</html>

